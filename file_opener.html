<!DOCTYPE html>
<html lang='en'>
 <p>Please Wait...</p>
 <script>
  window.bootstrap = true;
  script('syntax.js').then(_ => {
   bootstrapper.then(_ => {
    const script_files = new $.Database('ScriptFiles');
    if ('launchQueue' in window)
    {
     launchQueue.setConsumer(async launchParams => {
      const [handle] = launchParams.files;
      if (!handle) return null;
      
      const file = await handle.getFile();
      await script_files.set(file.name, handle);
      
      sessionStorage['file-mode'] = true;
      location.href = 'https://nexus-webdev.github.io/Ruin/Output.html?name=' +file.name;
     })
    }
   })
  })
  
  function script(src) {
   return new Promise((resolve, reject) => {
    const scriptTag = document.createElement('script');
    scriptTag.src = src;
    scriptTag.async = true;

    scriptTag.onload = _ => resolve(scriptTag);
    scriptTag.onerror = _ => reject(new Error(`Failed to load ${src}`));
    document.head.appendChild(scriptTag);
   });
  }
 </script>
</html>